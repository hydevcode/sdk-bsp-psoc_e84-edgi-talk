<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PSOC E8XXGP Device Support Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PSOC E8XXGP Device Support Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__group__rtc.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">API Reference</a>  </div>
  <div class="headertitle"><div class="title">RTC (Real-Time Clock)<div class="ingroups"><a class="el" href="group__group__pdl__top.html">PDL API Reference</a></div></div></div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">General Description</h2>
<p >The Real-Time Clock (RTC) driver provides an application interface for keeping track of time and date. </p>
<p >The functions and other declarations used in this driver are in cy_rtc.h. You can include cy_pdl.h to get access to all functions and declarations in the PDL.</p>
<p >Use the RTC driver when the system requires the current time or date. You can also use the RTC when you do not need the current time and date but you do need accurate timing of events with one-second resolution.</p>
<p >The RTC driver provides these features:</p><ul>
<li>Different hour format support.</li>
<li>Multiple alarm function (two-alarms).</li>
<li>Daylight Savings Time (DST) support.</li>
<li>Automatic leap year compensation.</li>
<li>Option to drive the RTC by an external 50 Hz or 60 Hz clock source</li>
</ul>
<p >The RTC driver provides access to the HW real-time clock. The HW RTC is located in the Backup domain. You need to choose the clock source for the Backup domain using the <a class="el" href="group__group__sysclk__clk__bak__funcs.html#gab72e0702bafe7df920708eacefdb40dd" title="Sets the source for the backup domain clock (clk_bak).">Cy_SysClk_ClkBakSetSource()</a> function. If the clock for the Backup domain is set and enabled, the RTC automatically starts counting.</p>
<p >The RTC driver keeps track of second, minute, hour, day of the week, day of the month, month, and year.</p>
<p >DST may be enabled and supports any start and end date. The start and end dates can be a fixed date (like 24 March) or a relative date (like the second Sunday in March).</p>
<p >The RTC has two alarms that you can configure to generate an interrupt. You specify the match value for the time when you want the alarm to occur. Your interrupt handler then handles the response. The alarm flexibility supports periodic alarms (such as every minute), or a single alarm (13:45 on 28 September, 2043).</p>
<p ><b> Clock Source </b></p>
<p >Depending on the available clocks the backup domain can be driven by:</p><ul>
<li>Watch-crystal oscillator (WCO). This is a high-accuracy oscillator that is suitable for RTC applications and requires a 32.768 kHz external crystal populated on the application board. The WCO can be supplied by Backup domain and therefore can run without Vddd/Vccd present. This can be used to wake the chip from Hibernate mode.</li>
<li>The Internal Low-speed Oscillator (ILO) routed from Clk_LF or directly (as alternate backup domain clock source). Depending on the device power mode the alternate backup domain clock source is set. For example, for Deep Sleep mode the ILO is routed through Clk_LF. But for Hibernate power mode the ILO is set directly. Note that, the ILO should be configured to work in the Hibernate mode. For more info refer to the <a class="el" href="group__group__sysclk.html">SysClk (System Clock)</a> driver. The ILO is a low-accuracy RC-oscillator that does not require any external elements on the board. Its poor accuracy (+/- 30%) means it is less useful for the RTC. However, current can be supplied by an internal power supply (Vback) and therefore it can run without Vddd/Vccd present. This also can be used to wake the chip from Hibernate mode using RTC alarm interrupt. For more details refer to <a class="el" href="group__group__syspm.html">SysPm (System Power Management)</a> driver description.</li>
<li>The Precision Internal Low-speed Oscillator (PILO), routed from Clk_LF (alternate backup domain clock source). This is an RC-oscillator (ILO) that can achieve accuracy of +/- 2% with periodic calibration. It is not expected to be accurate enough for good RTC capability. The PILO requires Vddd/Vccd present. It can be used in modes down to Deep Sleep, but ceases to function in Hibernate mode.</li>
<li>External 50 Hz or 60 Hz sine-wave clock source or 32.768 kHz square clock source. For example, the wall AC frequency can be the clock source. Such a clock source can be used if the external 32.768 kHz WCO is absent from the board. For more details, refer to the Cy_RTC_SelectFrequencyPrescaler() function description.</li>
</ul>
<p >The WCO is the recommended clock source for the RTC, if it is present in design. For setting the Backup domain clock source, refer to the <a class="el" href="group__group__sysclk.html">SysClk (System Clock)</a> driver.</p>
<dl class="section note"><dt>Note</dt><dd>If the WCO is enabled, it should source the Backup domain directly. Do not route the WCO through the Clk_LF. This is because Clk_LF is not available in all low-power modes.</dd></dl>
<h1><a class="anchor" id="group_rtc_section_configuration"></a>
Configuration Considerations</h1>
<p >Before RTC set up, ensure that the Backup domain is clocked with the desired clock source.</p>
<p >To set up an RTC, provide the configuration parameters in the <a class="el" href="group__group__rtc__data__structures.html#structcy__stc__rtc__config__t" title="This is the data structure that is used to configure the rtc time and date values.">cy_stc_rtc_config_t</a> structure. Then call Cy_RTC_Init(). You can also set the date and time at runtime. Call Cy_RTC_SetDateAndTime() using the filled <a class="el" href="group__group__rtc__data__structures.html#structcy__stc__rtc__config__t" title="This is the data structure that is used to configure the rtc time and date values.">cy_stc_rtc_config_t</a> structure, or call Cy_RTC_SetDateAndTimeDirect() with valid time and date values.</p>
<p ><b> RTC Interrupt Handling </b></p>
<p >The RTC driver provides three interrupt handler functions: Cy_RTC_Alarm1Interrupt(), Cy_RTC_Alarm2Interrupt(), and Cy_RTC_CenturyInterrupt(). All three functions are blank functions with the WEAK attribute. For any interrupt you use, redefine the interrupt handler in your source code.</p>
<p >When an interrupt occurs, call the Cy_RTC_Interrupt() function. The RTC hardware provides a single interrupt line to the NVIC for the three RTC interrupts. This function checks the interrupt register to determine which interrupt (out of the three) was generated. It then calls the appropriate handler.</p>
<dl class="section warning"><dt>Warning</dt><dd>The Cy_RTC_Alarm2Interrupt() is not called if the DST feature is enabled. If DST is enabled, the Cy_RTC_Interrupt() function redirects that interrupt to manage daylight savings time using Cy_RTC_DstInterrupt(). In general, the RTC interrupt handler function the Cy_RTC_DstInterrupt() function is called instead of Cy_RTC_Alarm2Interrupt().</dd></dl>
<p>For RTC interrupt handling, the user should:</p><ol type="1">
<li>Implement strong interrupt handling function(s) for the required events (see above). If DST is enabled, then Alarm2 is not available. The DST handler is built into the PDL.</li>
<li>Implement an RTC interrupt handler and call Cy_RTC_Interrupt() from there.</li>
<li>Configure the RTC interrupt:<ul>
<li>Set the mask for RTC required interrupt using Cy_RTC_SetInterruptMask().</li>
<li>Initialize the RTC interrupt by setting priority and the RTC interrupt vector using the <a class="el" href="group__group__sysint__functions.html#gab2ff6820a898e9af3f780000054eea5d" title="Initializes the referenced interrupt by setting the priority and the interrupt vector.">Cy_SysInt_Init()</a> function.</li>
<li>Enable the RTC interrupt using the CMSIS core function NVIC_EnableIRQ().</li>
</ul>
</li>
</ol>
<p ><b> Alarm functionality </b></p>
<p >To set up an alarm, enable the required RTC interrupt. Then provide the configuration parameters in the <a class="el" href="group__group__rtc__data__structures.html#structcy__stc__rtc__alarm__t" title="Decimal data structure that is used to save the Alarms.">cy_stc_rtc_alarm_t</a> structure. You enable any item you want matched, and provide a match value. You disable any other. You do not need to set match values for disabled elements, as they are ignored. </p><dl class="section note"><dt>Note</dt><dd>The alarm itself must be enabled in this structure. When a match occurs, the alarm is triggered and your interrupt handler is called.</dd></dl>
<p>An example is the best way to explain how this works. If you want an alarm on every hour, then in the <a class="el" href="group__group__rtc__data__structures.html#structcy__stc__rtc__alarm__t" title="Decimal data structure that is used to save the Alarms.">cy_stc_rtc_alarm_t</a> structure, you provide these values:</p>
<p >Alarm_1.sec = 0u <br  />
Alarm_1.secEn = CY_RTC_ALARM_ENABLE <br  />
Alarm_1.min = 0u <br  />
Alarm_1.minEn = CY_RTC_ALARM_ENABLE <br  />
Alarm_1.hourEn = CY_RTC_ALARM_DISABLE <br  />
Alarm_1.dayOfWeekEn = CY_RTC_ALARM_DISABLE <br  />
Alarm_1.dateEn = CY_RTC_ALARM_DISABLE <br  />
Alarm_1.monthEn = CY_RTC_ALARM_DISABLE <br  />
Alarm_1.almEn = CY_RTC_ALARM_ENABLE <br  />
 With this setup, every time both the second and minute are zero, Alarm1 is asserted. That happens once per hour. Note that, counterintuitively, to have an alarm every hour, Alarm_1.hourEn is disabled. This is disabled because for an hourly alarm you do not match the value of the hour.</p>
<p >After <a class="el" href="group__group__rtc__data__structures.html#structcy__stc__rtc__alarm__t" title="Decimal data structure that is used to save the Alarms.">cy_stc_rtc_alarm_t</a> structure is filled, call the Cy_RTC_SetAlarmDateAndTime(). The alarm can also be set without using the <a class="el" href="group__group__rtc__data__structures.html#structcy__stc__rtc__alarm__t" title="Decimal data structure that is used to save the Alarms.">cy_stc_rtc_alarm_t</a> structure. Call Cy_RTC_SetAlarmDateAndTimeDirect() with valid values.</p>
<p ><b> The DST Feature </b></p>
<p >The DST feature is managed by the PDL using the RTC Alarm2 interrupt. Therefore, you cannot have both DST enabled and use the Alarm2 interrupt.</p>
<p >To set up the DST, route the RTC interrupt to NVIC:</p>
<ol type="1">
<li>Initialize the RTC interrupt by setting priority and the RTC interrupt vector using <a class="el" href="group__group__sysint__functions.html#gab2ff6820a898e9af3f780000054eea5d" title="Initializes the referenced interrupt by setting the priority and the interrupt vector.">Cy_SysInt_Init()</a>.</li>
<li>Enable the RTC interrupt using the CMSIS core function NVIC_EnableIRQ().</li>
</ol>
<p >After this, provide the configuration parameters in the <a class="el" href="group__group__rtc__data__structures.html#structcy__stc__rtc__dst__t" title="This is the DST structure to handle start DST and stop DST.">cy_stc_rtc_dst_t</a> structure. This structure consists of two <a class="el" href="group__group__rtc__data__structures.html#structcy__stc__rtc__dst__format__t" title="This is DST structure for DST feature setting.">cy_stc_rtc_dst_format_t</a> structures, one for DST Start time and one for DST Stop time. You also specify whether these times are absolute or relative.</p>
<p >After the <a class="el" href="group__group__rtc__data__structures.html#structcy__stc__rtc__dst__t" title="This is the DST structure to handle start DST and stop DST.">cy_stc_rtc_dst_t</a> structure is filled, call Cy_RTC_EnableDstTime()</p>
<h1><a class="anchor" id="group_rtc_lp"></a>
Low Power Support</h1>
<p >The RTC provides the callback functions to facilitate the low-power mode transition. The callback Cy_RTC_DeepSleepCallback must be called during execution of Cy_SysPm_CpuEnterDeepSleep, Cy_RTC_HibernateCallback must be called during execution of Cy_SysPm_SystemEnterHibernate. To trigger the callback execution, the callback must be registered before calling the mode transition function. Refer to <a class="el" href="group__group__syspm.html">SysPm (System Power Management)</a> driver for more information about low-power mode transitions.</p>
<h1><a class="anchor" id="group_rtc_section_secure_aware"></a>
Secure Aware RTC</h1>
<p >Some RTC APIs are marked as Secure Aware. This means that if the RTC is marked as a secure resource in the Peripheral Protection Controller (PPC) and these APIs are called from a non-secure CPU state, the PDL will submit a request to the Secure Request Framework (SRF) middleware to transition to a secure CPU state to perform the operation. From the application's perspective, the API will behave the same whether it is called from a secure or non-secure CPU state albeit slower.</p>
<p >This functionality is automatically enabled on devices with ARM TrustZone processors. To disable, set the DEFINE+=CY_PDL_ENABLE_SECURE_AWARE_RTC=0 in the application Makefile.</p>
<p >For more information on Secure Aware PDL behavior, see <a class="el" href="group__group__pdl__srf.html#group_pdl_srf_general">Secure Aware PDL</a>.</p>
<h1><a class="anchor" id="group_rtc_section_more_information"></a>
More Information</h1>
<p >For more information on the RTC peripheral, refer to the technical reference manual (TRM). </p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="groups" name="groups"></a>
API Reference</h2></td></tr>
<tr class="memitem:group__group__rtc__macros"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__rtc__macros.html">Macros</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__rtc__functions"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__rtc__functions.html">Functions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__rtc__data__structures"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__rtc__data__structures.html">Data Structures</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__rtc__enums"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__rtc__enums.html">Enumerated Types</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>PSOC E8XXGP Device Support Library</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
